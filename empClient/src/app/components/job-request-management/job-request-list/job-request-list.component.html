<div class="search-results" infinite-scroll [infiniteScrollDistance]="scrollDistance"
    [infiniteScrollUpDistance]="scrollUpDistance" [infiniteScrollThrottle]="throttle" (scrolled)="onScrollDown()">


    <div class="container">
        <div class="table-responsive">

            <div class="table-wrapper">
                <div class="table-title">
                    <div class="row">
                        <div class="col-sm-6">
                            <h2>Manage <strong>Job Requests</strong></h2>
                        </div>
                        <div class="col-sm-6">
                        </div>
                    </div>
                </div>


                <div class="row">

                    <div class="col-2">
                        Show
                        <select class="form-select w-auto d-inline" [(ngModel)]="limit" (change)="resetList()">
                            <option selected="selected" [ngValue]="0" *ngIf="!scrollingDisabled">All</option>
                            <option [ngValue]="4">4</option>
                            <option [ngValue]="5">5</option>
                        </select>
                        entries
                    </div>

                    <div class="col-6 text-end">
                        <input placeholder="search" class="form-control w-auto d-inline align-self-end" type="text"
                            id="search" [(ngModel)]="search" (keyup)="setSearch()" />
                    </div>

                </div>

                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th scope="col">
                                <span class="custom-checkbox">
                                    <label for="selectAll"></label>
                                </span>
                            </th>



                            <th scope="col">Job Title </th>


                            <th scope="col" *ngIf="role" >User Name </th>

                            <th scope="col" (click)="setSort('remark')">Remark
                                <button [disabled]="sortBy!='remark'" class="btn btn-sort bi "
                                    [ngClass]="sortDesc ? 'bi-sort-alpha-up':'bi-sort-alpha-down'"></button>

                            </th>
                            <th scope="col">Status
                            </th>

                            <th scope="col" *ngIf="role">Actions</th>
                        </tr>
                    </thead>

                    <tbody *ngIf="jobRequestDataList">
                        <tr *ngIf="jobRequestDataList.length == 0">
                            <th class="text-center" id="NoRecordsFound" colspan="10">
                                No Records Found
                            </th>
                        </tr>
                        <tr *ngFor="let job of jobRequestDataList">
                            <td>

                            </td>
                            <td>{{ job.jobTitle }}</td>
                            <td *ngIf="role" (click)="open(userDetailsModule);userId=job.userId">{{ job.name }}<em
                                    class="bi bi-eye-fill mx-2"></em></td>
                            <td>{{ job.remark }}</td>

                            <td>
                                <p *ngIf="job.status == 0"><span class="badge bg-warning clr">{{ status[job.status]
                                        }}</span></p>
                                <p *ngIf="job.status == 1"><span class="badge bg-success">{{ status[job.status]
                                        }}</span>
                                </p>
                                <p *ngIf="job.status == 2"><span class="badge bg-danger">{{ status[job.status] }}</span>
                                </p>
                            </td>

                            <td *ngIf="role">

                                <div class="flex">
                                    <button class="btn btn-sort btn-outline-success" ngbTooltip="Approve"
                                        [disabled]="job.status == 1"
                                        (click)=" remark.patchValue(job.remark); jobRequestId = job.jobRequestId; action = 1;open(remarkModal);"><span
                                            class="bi bi-check-circle"></span></button>
                                    &nbsp;

                                    <button class="btn btn-sort btn-outline-danger" ngbTooltip="Reject"
                                        [disabled]="job.status == 2"
                                        (click)=" remark.patchValue(job.remark); jobRequestId = job.jobRequestId; action = 2;open(remarkModal);"><span
                                            class="bi bi-x-circle-fill"></span></button>
                                </div>
                            </td>


                        </tr>
                        <tr *ngIf="pagerInfo &&!pagerInfo.hasNext && jobRequestDataList.length != 0">
                            <th class="text-center" id="NoRecordsFound" colspan="10">
                                End of Records
                            </th>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="clearfix" *ngIf="pagerInfo && limit">
            <div class="hint-text text-white">
                Showing &nbsp;
                <strong>{{ pagerInfo.itemStart }} </strong> to <strong> {{ pagerInfo.itemEnd }} </strong> out of
                <strong>{{ pagerInfo.numItems }}</strong> &nbsp; entries
            </div>

            <div>
                <ul class="pagination mb-5">

                    <li class="page-item" [class.disabled]="!pagerInfo.hasPrev">
                        <button class="page-link" (click)="gotoPage(1)">
                            First
                        </button>
                    </li>
                    <li class="page-item" [class.disabled]="!pagerInfo.hasPrev">
                        <button class="page-link" (click)="prevPage()"><em class="bi bi-caret-left-fill"></em></button>
                    </li>

                    <li class="page-item" *ngIf="pagerInfo.currentPage  > 3 && pagerInfo.numPages>5 ">
                        <button class="page-link" disabled>
                            ..
                        </button>
                    </li>

                    <li class="page-item" *ngFor="let s of numSeq(pagerInfo.numPages);"
                        [ngClass]="{ active: pagerInfo.currentPage == s }">
                        <button (click)="gotoPage(s)" class="page-link">
                            {{ s }}
                        </button>
                    </li>

                    <li class="page-item"
                        *ngIf="pagerInfo.currentPage < pagerInfo.numPages - 2 && pagerInfo.numPages>5">
                        <button class="page-link" disabled>
                            ..
                        </button>
                    </li>



                    <li class="page-item" [class.disabled]="!pagerInfo.hasNext">
                        <button class="page-link" (click)="nextPage()"><em class="bi bi-caret-right-fill"></em></button>
                    </li>

                    <li class="page-item" [class.disabled]="!pagerInfo.hasNext">
                        <button class="page-link" (click)="gotoPage(pagerInfo.numPages)">
                            Last
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>


    <ng-template #remarkModal let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">

            <input [formControl]="remark" class="form-control" placeholder="Remarks..." type="text" id="remark">

            <div class="text-danger" *ngIf="remark.errors?.['maxlength']">
                Remark Should be less than 50 characters.
            </div>

        </div>
        <div class="modal-footer">
            <button *ngIf="action==1" class="btn btn-outline-success"
                (click)="updateStatus(jobRequestId,action);modal.dismiss()"> Approve </button>
            <button *ngIf="action==2" class="btn btn-outline-danger"
                (click)="updateStatus(jobRequestId,action);modal.dismiss()"> Reject </button>
        </div>
    </ng-template>

    <!-- Spinner -->
    <div *ngIf="showSpinner" class="loading">Loading&#8230;</div>

</div>
<ng-template #userDetailsModule let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">User Details</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <app-user-detail [userId]="userId"></app-user-detail>
    </div>
</ng-template>