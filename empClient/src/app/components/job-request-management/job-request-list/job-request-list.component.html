<div class="container">
    <div class="table-responsive">

        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-6">
                        <h2>Manage <strong>Job Requests</strong></h2>
                    </div>
                    <div class="col-sm-6">

                        <!-- 
                        <button placement="bottom" ngbTooltip="Delete selected jobs from table" (click)="deleteJobs()"
                            class="btn btn-danger" [disabled]="!checked.length">
                            <em class="bi-trash-fill"></em>
                            &nbsp;Delete Jobs
                        </button>

                        <button placement="bottom" ngbTooltip="Download job list as Csv" (click)="downloadCsv()"
                            class="btn btn-secondary">
                            <em class="bi bi-download"></em>
                            &nbsp;Download
                        </button> -->
                    </div>
                </div>
            </div>


            <div class="row">

                <div class="col-6">
                    Show
                    <select class="form-select w-auto d-inline" [(ngModel)]="limit" (change)="setLimit()">
                        <option selected="selected" [ngValue]="3">3</option>
                        <option [ngValue]="4">4</option>
                        <option [ngValue]="5">5</option>
                    </select>
                    entries
                </div>

                <div class="col-6 text-end">
                    <input placeholder="search" class="form-control w-auto d-inline align-self-end" type="text"
                        id="search" [(ngModel)]="search" (keyup)="setSearch()" />
                </div>

            </div>

            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col">
                            <span class="custom-checkbox">
                                <!-- <input type="checkbox" id="selectAll" (change)="checkAll($event)" /> -->
                                <label for="selectAll"></label>
                            </span>
                        </th>

                        <th scope="col" (click)="setSort('jobRequestId')">Id
                            <button [disabled]="sortBy!='jobRequestId'" class="btn btn-sort bi "
                                [ngClass]="sortDesc ? 'bi-sort-numeric-up':'bi-sort-numeric-down'"></button>

                        </th>

                        <th scope="col" (click)="setSort('jobId')">Job Id
                            <button [disabled]="sortBy!='jobId'" class="btn btn-sort bi "
                                [ngClass]="sortDesc ? 'bi-sort-numeric-up':'bi-sort-numeric-down'"></button>

                        </th>

                        <th scope="col">Job Title </th>

                        <th scope="col" (click)="setSort('userId')">User Id
                            <button [disabled]="sortBy!='userId'" class="btn btn-sort bi "
                                [ngClass]="sortDesc ? 'bi-sort-numeric-up':'bi-sort-numeric-down'"></button>

                        </th>
                        <th scope="col">User Name </th>

                        <th scope="col" (click)="setSort('remark')">Remark
                            <button [disabled]="sortBy!='remark'" class="btn btn-sort bi "
                                [ngClass]="sortDesc ? 'bi-sort-alpha-up':'bi-sort-alpha-down'"></button>

                        </th>
                        <!-- <th scope="col" (click)="setSort('')">Last Modified <span class="bi bi-sort-alpha-down"></span></th> -->
                        <th scope="col">Status
                        </th>

                        <th scope="col" *ngIf="role">Actions</th>
                    </tr>
                </thead>

                <tbody *ngIf="jobList">
                    <tr *ngIf="jobList.result.length == 0">
                        <th class="text-center" id="NoRecordsFound" colspan="10">
                            No Records Found
                        </th>
                    </tr>
                    <tr *ngFor="let job of jobList.result">
                        <td>
                            <!-- <span class="custom-checkbox">
                                <input type="checkbox" id="checkbox{{ job.jobId }}" value="{{ job.jobId }}"
                                    (change)="checkedUser($event)" />
                                <label for="checkbox{{ job.jobId }}"></label>
                            </span> -->
                        </td>
                        <td>{{ job.jobRequestId }}</td>
                        <td>{{ job.jobId }}</td>
                        <td>{{ job.jobTitle }}</td>
                        <td>{{ job.userId }}</td>
                        <td>{{ job.userName }}</td>
                        <td>{{ job.remark }}</td>

                        <!-- <td>{{ job.updateDate }}</td> -->


                        <td>{{ status[job.status] }}</td>

                        <td *ngIf="role">


                            <button class="btn btn-sort btn-outline-success" ngbTooltip="Approve"
                                [disabled]="job.status == 1"
                                (click)=" remark.patchValue(job.remark); jobRequestId = job.jobRequestId; action = 1;open(remarkModal);"><span
                                    class="bi bi-check-circle"></span></button>
                            &nbsp;

                            <button class="btn btn-sort btn-outline-danger" ngbTooltip="Reject"
                                [disabled]="job.status == 2"
                                (click)=" remark.patchValue(job.remark); jobRequestId = job.jobRequestId; action = 2;open(remarkModal);"><span
                                    class="bi bi-x-circle-fill"></span></button>
                        </td>


                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="clearfix" *ngIf="jobList">
        <div class="hint-text">
            Showing &nbsp;
            <strong>{{ jobList.itemStart }} </strong> to <strong> {{ jobList.itemEnd }} </strong> out of
            <strong>{{ jobList.numItems }}</strong> &nbsp; entries
        </div>

        <div>
            <ul class="pagination pagination-sm">
                <li class="page-item" [class.disabled]="!jobList.hasPrevious">
                    <button class="page-link" (click)="prevPage()">Previous</button>
                </li>

                <li class="page-item" *ngFor="let s of numSeq(jobList.numPages); let i = index"
                    [ngClass]="{ active: jobList.currentPage == i + 1 }">
                    <button (click)="gotoPage(i + 1)" class="page-link">
                        {{ i + 1 }}
                    </button>
                </li>

                <li class="page-item" [class.disabled]="!jobList.hasNext">
                    <button class="page-link" (click)="nextPage()">Next</button>
                </li>
            </ul>
        </div>
    </div>
</div>


<ng-template #remarkModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">

        <input [formControl]="remark" class="form-control" placeholder="Remarks..." type="text" id="remark">

        <div class="text-danger" *ngIf="remark.errors?.['maxlength']">
            Remark Should be less than 50 characters.
        </div>

    </div>
    <div class="modal-footer">
        <button *ngIf="action==1" class="btn btn-outline-success"
            (click)="updateStatus(jobRequestId,action);modal.dismiss()"> Approve </button>
        <button *ngIf="action==2" class="btn btn-outline-danger"
            (click)="updateStatus(jobRequestId,action);modal.dismiss()"> Reject </button>
    </div>
</ng-template>